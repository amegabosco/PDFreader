<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOPS CAR PDF Power-Tool</title>
    <meta name="description" content="Client-side PDF reader and editor for UNOPS CAR">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">

    <!-- Web App Manifest -->
    <link rel="manifest" href="/site.webmanifest">

    <!-- Theme Color -->
    <meta name="theme-color" content="#4a90e2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="UNOPS PDF">

    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css?v=2.2.7">
</head>
<body>
    <!-- Notification Banner -->
    <div id="notificationBanner" class="notification-banner"></div>

    <!-- App Title - Fixed Bottom Left -->
    <div class="app-title-badge">
        <div class="app-name">UNOPS CAR PDF</div>
        <div class="app-version">ðŸŽ¯ Precision 2.2.7</div>
        <div class="app-author">Made by Yao</div>
    </div>

    <div class="app-container">

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Upload Area (shown initially) -->
            <div id="uploadArea" class="upload-area">
                <div class="upload-dropzone">
                    <i class="ti ti-cloud-upload"></i>
                    <h2>Drop PDF files here</h2>
                    <p>or click to browse</p>
                    <input type="file" id="fileInput" accept=".pdf" multiple hidden>
                    <button class="browse-btn" title="Browse and select PDF files from your computer">
                        Browse Files
                    </button>
                </div>
            </div>

            <!-- PDF Viewer Area (hidden initially) -->
            <div id="viewerArea" class="viewer-area" style="display: none;">
                <!-- Tabs Bar -->
                <div id="tabsBar" class="tabs-bar">
                    <div id="tabsList" class="tabs-list">
                        <!-- Tabs will be dynamically inserted here -->
                    </div>
                    <button id="newTabBtn" class="new-tab-btn" title="Open new PDF">
                        <i class="ti ti-plus"></i>
                    </button>
                </div>

                <div class="viewer-controls">
                    <!-- Navigation Controls -->
                    <button id="prevPage" class="control-btn" title="Go to previous page (â†)">
                        <i class="ti ti-chevron-left"></i>
                    </button>
                    <div class="page-input-group">
                        <input type="number" id="pageInput" min="1" value="1" title="Go to page">
                        <span class="page-separator">/</span>
                        <span id="totalPages">1</span>
                    </div>
                    <button id="nextPage" class="control-btn" title="Go to next page (â†’)">
                        <i class="ti ti-chevron-right"></i>
                    </button>

                    <div class="toolbar-separator"></div>

                    <!-- Zoom Controls -->
                    <div class="zoom-controls">
                        <button id="zoomOut" class="control-btn" title="Zoom out (-)">
                            <i class="ti ti-zoom-out"></i>
                        </button>
                        <span id="zoomLevel">100%</span>
                        <button id="zoomIn" class="control-btn" title="Zoom in (+)">
                            <i class="ti ti-zoom-in"></i>
                        </button>
                        <button id="zoomFit" class="control-btn" title="Fit page to window">
                            <i class="ti ti-arrows-maximize"></i>
                        </button>
                    </div>

                    <div class="toolbar-separator"></div>

                    <!-- Edit Tools -->
                    <button class="control-btn tool-btn" data-tool="annotate" disabled title="Add text annotations to PDF pages">
                        <i class="ti ti-pencil"></i>
                    </button>
                    <button class="control-btn tool-btn" data-tool="sign" disabled title="Draw or insert your signature on the PDF">
                        <i class="ti ti-signature"></i>
                    </button>
                    <button class="control-btn tool-btn" data-tool="image" disabled title="Insert an image (PNG/JPG) onto a PDF page">
                        <i class="ti ti-photo-plus"></i>
                    </button>

                    <div class="toolbar-separator"></div>

                    <!-- Document Tools -->
                    <button class="control-btn tool-btn" data-tool="rotate" disabled title="Rotate selected pages 90Â° clockwise">
                        <i class="ti ti-rotate-clockwise"></i>
                    </button>
                    <button class="control-btn tool-btn" data-tool="split" disabled title="Split PDF into two parts at a specific page">
                        <i class="ti ti-cut"></i>
                    </button>
                    <button class="control-btn tool-btn" data-tool="merge" disabled title="Combine multiple PDF files into one document">
                        <i class="ti ti-files"></i>
                    </button>

                    <div class="toolbar-separator"></div>

                    <!-- History Controls -->
                    <button id="undoBtn" class="control-btn" title="Undo (Ctrl+Z)" disabled onclick="undo()">
                        <i class="ti ti-arrow-back-up"></i>
                    </button>
                    <button id="redoBtn" class="control-btn" title="Redo (Ctrl+Y)" disabled onclick="redo()">
                        <i class="ti ti-arrow-forward-up"></i>
                    </button>

                    <div class="toolbar-separator"></div>

                    <!-- Utility Tools -->
                    <button class="control-btn tool-btn" id="handToolBtn" data-tool="hand" disabled title="Pan and move around zoomed PDF pages">
                        <i class="ti ti-hand-grab"></i>
                    </button>
                    <button id="searchBtn" class="control-btn" title="Search Text (Ctrl+F)">
                        <i class="ti ti-search"></i>
                    </button>
                    <button id="toggleNavPanel" class="control-btn" title="Toggle Page Navigator">
                        <i class="ti ti-layout-sidebar-right"></i>
                    </button>
                    <button id="toggleInfoBar" class="control-btn" title="Toggle Information Bar">
                        <i class="ti ti-info-circle"></i>
                    </button>

                    <div class="toolbar-separator"></div>

                    <!-- Language Toggle -->
                    <button id="langToggleBtn" class="control-btn" title="Change Language">
                        <i class="ti ti-language"></i>
                    </button>

                    <div class="toolbar-separator"></div>

                    <!-- Download -->
                    <button class="control-btn tool-btn download-btn" data-tool="download" disabled title="Download the current PDF with all edits">
                        <i class="ti ti-download"></i>
                    </button>
                </div>

                <!-- Search Bar (collapsible) -->
                <div id="searchBar" class="search-bar" style="display: none;">
                    <div class="search-input-container">
                        <i class="ti ti-search"></i>
                        <input type="text" id="searchInput" placeholder="Search in document..." />
                        <button id="clearSearchBtn" class="search-clear-btn" title="Clear search">
                            <i class="ti ti-x"></i>
                        </button>
                    </div>
                    <div class="search-controls">
                        <button id="prevMatch" class="control-btn" title="Previous match">
                            <i class="ti ti-chevron-up"></i>
                        </button>
                        <span id="searchResults">0 / 0</span>
                        <button id="nextMatch" class="control-btn" title="Next match">
                            <i class="ti ti-chevron-down"></i>
                        </button>
                        <label class="search-option">
                            <input type="checkbox" id="caseSensitive" />
                            <span>Aa</span>
                        </label>
                        <label class="search-option">
                            <input type="checkbox" id="wholeWord" />
                            <span>Word</span>
                        </label>
                    </div>
                </div>

                <!-- Info Bar (always visible) -->
                <div id="infoBar" class="info-bar">
                    <div class="info-item">
                        <span class="info-label">File:</span>
                        <span class="info-value" id="infoFileName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Pages:</span>
                        <span class="info-value" id="infoPages">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Size:</span>
                        <span class="info-value" id="infoFileSize">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Memory:</span>
                        <span class="info-value" id="infoMemory">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Edits:</span>
                        <span class="info-value" id="infoEdits">0</span>
                    </div>
                </div>

                <div class="pdf-canvas-container">
                    <canvas id="pdfCanvas"></canvas>
                    <!-- Insertion Overlay for pending objects -->
                    <div id="insertionOverlay" class="insertion-overlay"></div>

                    <!-- PDF Loading Progress Overlay -->
                    <div id="pdfLoadingOverlay" class="pdf-loading-overlay" style="display: none;">
                        <div class="pdf-loading-content">
                            <div class="pdf-loading-spinner"></div>
                            <div class="pdf-loading-text">Loading PDF...</div>
                            <div class="pdf-loading-progress-bar">
                                <div id="pdfLoadingProgressFill" class="pdf-loading-progress-fill"></div>
                            </div>
                            <div id="pdfLoadingPercentage" class="pdf-loading-percentage">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Validate All Button (shown when pending objects exist) -->
                <div id="validateAllContainer" class="validate-all-container" style="display: none;">
                    <button id="validateAllBtn" class="validate-all-btn" title="Insert all pending objects into the PDF">
                        <i class="ti ti-check"></i>
                        <span id="validateAllText">Validate All (0)</span>
                    </button>
                    <button id="cancelAllBtn" class="cancel-all-btn" title="Remove all pending objects without inserting">
                        <i class="ti ti-x"></i>
                        Cancel All
                    </button>
                </div>
            </div>

            <!-- Tool Panels (hidden initially, shown when tool is selected) -->
            <div id="toolPanel" class="tool-panel" style="display: none;">
                <!-- Dynamic tool panels will be inserted here -->
            </div>
        </main>

        <!-- Document Navigator Panel (Right Side) -->
        <aside id="navPanel" class="nav-panel" style="display: none;">
            <div class="nav-header">
                <h3><i class="ti ti-layout-grid"></i> Pages</h3>
                <button id="closeNavPanel" class="nav-close-btn" title="Close Navigator">
                    <i class="ti ti-x"></i>
                </button>
            </div>
            <div id="navThumbnails" class="nav-thumbnails">
                <!-- Thumbnails will be generated here -->
            </div>
        </aside>
    </div>

    <!-- PDF.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>

    <!-- PDF-lib Library -->
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

    <!-- Disable scroll restoration -->
    <script>
        // Prevent browser from restoring scroll position
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }

        // Force all containers to scroll to 0 on page load
        window.addEventListener('load', () => {
            const pdfContainer = document.querySelector('.pdf-canvas-container');
            if (pdfContainer) {
                pdfContainer.scrollTop = 0;
                console.log('ðŸ”’ [PAGE LOAD] Forced container scroll to 0');
            }
        });
    </script>

    <!-- Custom JavaScript -->
    <script src="js/i18n.js?v=2.2.7"></script>
    <script src="js/pdfCache.js?v=2.2.7"></script>
    <script src="js/signatureLibrary.js?v=2.2.7"></script>
    <script src="js/annotationLibrary.js?v=2.2.7"></script>
    <script src="js/floatingPanel.js?v=2.2.7"></script>
    <script src="js/workerManager.js?v=2.2.7"></script>
    <script src="js/pdfViewer.js?v=2.2.7"></script>
    <script src="js/pdfTools.js?v=2.2.7"></script>
    <script src="js/pngInsertionOverlay.js?v=2.2.7"></script>
    <script src="js/app.js?v=2.2.7"></script>
</body>
</html>
